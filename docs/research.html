<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.554">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Lucas Finamor - Research</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-CJ9KSTW928"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-CJ9KSTW928', { 'anonymize_ip': true});
</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Lucas Finamor</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./cv.html"> 
<span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./research.html" aria-current="page"> 
<span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./policy_reports.html"> 
<span class="menu-text">Policy Reports</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./teaching.html"> 
<span class="menu-text">Teaching</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://scholar.google.com/citations?hl=en&amp;user=L52go7EAAAAJ" target="_blank"> <i class="bi bi-google" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.twitter.com/finamor_lucas/" target="_blank"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:lucas.finamor@ifs.org.uk" target="_blank"> <i class="bi bi-envelope" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#published-articles" id="toc-published-articles" class="nav-link active" data-scroll-target="#published-articles">Published Articles</a></li>
  <li><a href="#working-papers" id="toc-working-papers" class="nav-link" data-scroll-target="#working-papers">Working Papers</a></li>
  <li><a href="#work-in-progress" id="toc-work-in-progress" class="nav-link" data-scroll-target="#work-in-progress">Work in Progress</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-page-left" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Research</h1>
</div>



<div class="quarto-title-meta column-page-left">

    
  
    
  </div>
  


</header>


<style>
  details{
    padding: 7pt;
  }
details[open]{
    background: #eeeeee;
}
</style>
<section id="published-articles" class="level2">
<h2 class="anchored" data-anchor-id="published-articles">Published Articles</h2>
<ol>
<li>
“Labor Market Conditions and College Graduation: evidence from Brazil”, <b>Economics of Education Review</b>, <i> 94C 102403</i> (2023).<span style="font-size:11pt;color:blue"> <span style="margin-left:10px"> <a href="https://doi.org/10.1016/j.econedurev.2023.102403" target="_blank">[Published Version]</a> </span> <span style="margin-left:10px"> <a href="https://lucasfinamor.github.io/files/Finamor_2023_EER_manuscript.pdf" target="_blank">[Open Access Manuscript]</a> </span> </span>
<details>
<summary style="font-size:10pt">
<i>(Abstract) </i>
</summary>
<p style="font-size:10pt" align="justify">
College students graduating in a recession have been shown to face large and persistent negative effects on their earnings, health, and other outcomes. This paper investigates whether students delay graduation to avoid these effects. Using data on the universe of students in higher education in Brazil and leveraging variation in labor market conditions across time, space, and chosen majors, the paper finds that students in public institutions delay graduation to avoid entering depressed labor markets. A typical recession causes the on-time graduation rate to fall by 6.5% in public universities and there is no effect on private institutions. The induced delaying increases average graduation by 0.11 semesters, consistent with 1 out of 18 students delaying graduation by one year in public universities. The delaying effect is larger for students with higher scores, in higher-earnings majors, and from more advantaged backgrounds. This has important implications for the distributional impact of recessions.
</p>
</details>
</li>
<li>
“Labor Market Trends and Unemployment Insurance Generosity During the Pandemic” <i>(with Dana Scott)</i>, <b>Economics Letters</b>, <i>199C, 109722</i> (2021). <span style="font-size:11pt;color:blue"> <span style="margin-left:10px"> <a href="https://doi.org/10.1016/j.econlet.2020.109722" target="_blank">[Published Version]</a> </span> <span style="margin-left:10px"> <a href="https://lucasfinamor.github.io/files/Finamor_Scott_2021_Manuscript.pdf" target="_blank">[Open Access Manuscript]</a> </span> </span>
<details>
<summary style="font-size:10pt">
<i>(Abstract)</i>
</summary>
<p style="font-size:10pt" align="justify">
We test whether changes in unemployment insurance (UI) benefit generosity under the CARES Act in the US are associated with differential employment outcomes under the distinct conditions of the pandemic. While we observe a negative association between UI generosity and employment, we show that the relative employment gap arises before the Act was instituted, decreases in magnitude when the augmented benefits were in place, and does not change when the benefits expansion expires.
</p>
</details>
<span style="font-size:10pt"> Media coverage: <a href="https://www.cnbc.com/2021/01/12/600-unemployment-boost-backed-by-ron-wyden-not-a-work-disincentive.html" target="_blank">CNBC</a>, <a href="https://time.com/6078388/myth-generous-unemployment-benefits/?utm_source=feedburner&amp;utm_medium=feed&amp;utm_campaign=Feed%3A+time%2Fideas+%28TIME+Ideas%29" target="_blank">Time</a>, <a href="https://ca.news.yahoo.com/u-spends-less-nearly-every-164720852.html" target="_blank">Yahoo Canada</a>, <a href="https://newrepublic.com/article/160837/case-2000-checks" target="_blank">New Republic</a>, and <a href="https://plu.mx/plum/a/news?doi=10.1016/j.econlet.2020.109722&amp;theme=plum-sciencedirect-theme&amp;hideUsage=true" target="_blank">4 others</a> </span>
</li>
</ol>
<p><br></p>
</section>
<section id="working-papers" class="level2">
<h2 class="anchored" data-anchor-id="working-papers">Working Papers</h2>
<ol>
<li>
“Labor Market Informality, Risk, and Public Insurance”, <i>January 2023</i>. <span style="font-size:11pt;color:blue"> <span style="margin-left:10px"> <a href="https://lucasfinamor.github.io/files/Finamor_Lucas_JMP.pdf" target="_blank">[Manuscript]</a> </span> </span>
<details>
<summary style="font-size:10pt">
<i>(Abstract) </i>
</summary>
<p style="font-size:10pt" align="justify">
A large proportion of workers in developing countries are informal and are not covered by social insurance programs, including pensions and unemployment insurance (UI), depriving them of key mechanisms for mitigating risks. To address this important social issue, governments often offer noncontributory benefits. The design of these programs has implications for employment choices and savings. To understand how policy can affect these life cycle choices, I develop a life-cycle model of formal, informal, and self-employment. Formal employment gives access to a bundle of public insurance programs, while informal workers are covered by basic pension guarantees. I estimate the parameters of the model using longitudinal survey data linked with administrative data from Chile and exploiting policy reforms to the pension system. The estimates suggest that the role of savings as self-insurance, the presence of borrowing constraints, and job amenities are important drivers of employment decisions. I also show evidence of complementarities between pensions and UI: when individuals have access to UI to insure themselves in the short run, they are more likely to invest in pensions. In counterfactual simulations, I show how the pension design affects formality decisions.
</p>
</details>
</li>
<li>
“Youth Subjective Life Expectancy and Early Labor Market Choices”, <i>May 2024</i>. <span style="font-size:11pt;color:blue"> <span style="margin-left:10px"> <a href="https://lucasfinamor.github.io/files/finamor_youthSLE.pdf" target="_blank">[Manuscript]</a> </span> </span>
<details>
<summary style="font-size:10pt">
<i>(Abstract)</i>
</summary>
<p style="font-size:10pt" align="justify">
The literature has documented how subjective life expectancy (SLE) is strongly associated with savings and retirement outcomes for those nearing retirement. This paper assesses whether SLE matters when young individuals make consequential career decisions at the labor market entrance. Exploring survey and administrative data from Chile, I show how individuals aged 18-26 with one standard deviation higher SLE had 11.6%-14.8% higher pension wealth 15 years later. Working formally accounts for a large share of these pension gaps. I also show how these expectations respond to new information and how individuals revise their actions consistently with their revised expectations.
</p>
</details>
</li>
<li>
“Are Public Schools in Developing Countries Ready to Integrate EdTech into Regular Instruction?” <i>(with <a href="https://sites.google.com/site/brunoferman" target="_blank">Bruno Ferman</a> and Lycia Lima)</i>, <i>March 2022</i>. <span style="font-size:11pt;color:blue"> <span style="margin-left:10px"> <a href="https://mpra.ub.uni-muenchen.de/109063/1/MPRA_paper_109063.pdf" target="_blank">[Manuscript]</a> </span> </span>
<details>
<summary style="font-size:10pt">
<i>(Abstract) </i>
</summary>
<p style="font-size:10pt" align="justify">
We study the impacts of a program that introduced a computer-assisted learning platform into regular math classes using a randomized control trial in Brazilian primary public schools. Once a week, teachers would take their students to the school’s computer lab and teach using a dynamically adaptive platform, instead of their standard math classes. We find no average treatment effect on students’ math proficiency. However, we find positive effects of the program on measures of attitudes towards math. Moreover, we find suggestive evidence that the program may have positive effects on proficiency when infrastructure is better, so that it can be implemented using one computer per student. These results highlight the implementation challenges associated with education technology interventions in developing countries.
</p>
</details>
</li>
<li>
“School closures and educational path: how the Covid-19 pandemic affected transitions to college” <i>(with <a href="https://sites.google.com/site/festevang/" target="_blank"> Fernanda Estevan</a>)</i>, <i>September 2022</i>. <span style="font-size:11pt;color:blue"> <span style="margin-left:10px"> <a href="https://arxiv.org/pdf/2210.00138.pdf" target="_blank">[Manuscript]</a> </span></span>
<details>
<summary style="font-size:10pt">
<i>(Abstract) </i>
</summary>
<p style="font-size:10pt" align="justify">
We investigate the impact of the Covid-19 pandemic on the transition between high school and college in Brazil. Using microdata from the universe of students that applied to a selective university, we document how the Covid-19 shock increased enrollment for students in the top 10% high-quality public and private high schools. This increase comes at the expense of graduates from relatively lower-quality schools. Furthermore, this effect is entirely driven by applicants who were at high school during the Covid pandemic. The effect is large and completely offsets the gains in student background diversity achieved by a bold quota policy implemented years before Covid. These results suggest that not only students from underprivileged backgrounds endured larger negative effects on learning during the pandemic, but they also experienced a stall in their educational paths.
</p>
</details>
</li>
</ol>
<p><br></p>
</section>
<section id="work-in-progress" class="level2">
<h2 class="anchored" data-anchor-id="work-in-progress">Work in Progress</h2>
<ol>
<li>
“There must be an error here! Experimental evidence on coding errors’ biases” <i>(with <a href="https://sites.google.com/site/brunoferman" target="_blank">Bruno Ferman</a>)</i>. <span style="font-size:11pt;color:blue"> </span>
<details>
<summary style="font-size:10pt">
<i>(Abstract)</i>
</summary>
<p style="font-size:10pt" align="justify">
Economics research relies heavily on computational activities. Nonetheless, coding errors are widely present, even in papers that have gone through peer review processes. In this paper, we investigate whether researchers have differential probabilities for debugging their codes, depending on the results they face. We test this hypothesis in a randomized experiment in which common coding errors would lead to either expected or unexpected results. If researchers are less likely to look for coding errors when encountering non-favorable results, this implies a bias in the scientific inquiry.
</p>
<p style="font-size:10pt" align="justify">
<i> The RCT is currently being implemented. The pre-analysis plan was uploaded to <a href="https://www.socialscienceregistry.org/trials/8312" target="_blank">AEA-RCT-Registry 0008312</a>. </i>
</p>
</details>
</li>
</ol>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/lucasfinamor\.github\.io");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>